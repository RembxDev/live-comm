# =========================
# chat-service
# =========================
spring.application.name=chat-service

# Port
server.port=${SERVER_PORT:8082}

# --- DATABASE (PostgreSQL) ---
spring.datasource.url=jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:chatdb}
spring.datasource.username=${DB_USER:chat}
spring.datasource.password=${DB_PASSWORD:chat}
spring.datasource.driver-class-name=org.postgresql.Driver

# --- JPA / Hibernate ---
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.open-in-view=false
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.jdbc.time_zone=UTC
spring.jpa.properties.hibernate.default_schema=chat

# --- Flyway ---
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration
spring.flyway.schemas=chat
spring.flyway.default-schema=chat
spring.flyway.baseline-on-migrate=true

spring.sql.init.mode=never

# --- RabbitMQ (AMQP) ---
spring.rabbitmq.host=${RABBIT_HOST:localhost}
spring.rabbitmq.port=${RABBIT_PORT:5672}
spring.rabbitmq.username=${RABBIT_USER:chat}
spring.rabbitmq.password=${RABBIT_PASSWORD:chat}

# --- STOMP Relay (Rabbit STOMP plugin) ---
# Uwaga: chat-service mo?e ??czy? do hostowego portu zmapowanego (dev) albo
# do portu kontenera 61613 (docker).
chat.stomp.relay.enabled=${STOMP_RELAY_ENABLED:true}
chat.stomp.relay.host=${STOMP_RELAY_HOST:localhost}
chat.stomp.relay.port=${STOMP_RELAY_PORT:36161}
chat.stomp.relay.system-login=${STOMP_RELAY_SYS_LOGIN:chat}
chat.stomp.relay.system-passcode=${STOMP_RELAY_SYS_PASS:chat}
chat.stomp.relay.client-login=${STOMP_RELAY_CLIENT_LOGIN:chat}
chat.stomp.relay.client-passcode=${STOMP_RELAY_CLIENT_PASS:chat}


# --- STOMP CONNECT Auth (nag?ówek: x-session-id) ---
chat.stomp.auth.enabled=${STOMP_AUTH_ENABLED:false}

# --- Integracja z session-service (Feign) ---
session.service.base-url=${SESSION_BASE_URL:http://localhost:8081}

# --- Logging ---
logging.level.org.springframework.web=INFO
logging.level.org.springframework.messaging=INFO
logging.level.com.s26984.chatservice=DEBUG

# --- Actuator ---
management.endpoints.web.exposure.include=health,info
management.endpoint.health.probes.enabled=true

feign.client.config.default.connectTimeout=2000
feign.client.config.default.readTimeout=2000

resilience4j.circuitbreaker.instances.session.slidingWindowSize=10
resilience4j.circuitbreaker.instances.session.minimumNumberOfCalls=5
resilience4j.circuitbreaker.instances.session.failureRateThreshold=50
resilience4j.retry.instances.session.maxAttempts=3
resilience4j.retry.instances.session.waitDuration=250ms